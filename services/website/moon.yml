id: website

language: typescript

fileGroups:
  sources:
    - "src/**/*"

tasks:
  build:
    command: "bun run build"
    options:
      runInCI: true
      outputStyle: stream

  preview:
    command: "bunx wrangler dev"
    deps:
      - "~:build"
    options:
      runInCI: false

  deploy-preview:
    command: "bunx wrangler versions upload"
    deps:
      - "~:build"
    options:
      runInCI: false
    env:
      CLOUDFLARE_API_TOKEN: ${CLOUDFLARE_API_TOKEN}
      CLOUDFLARE_ACCOUNT_ID: ${CLOUDFLARE_ACCOUNT_ID}

  deploy-production:
    command: "bunx wrangler deploy"
    deps:
      - "~:build"
    options:
      runInCI: false

  dev:
    command: "bun run dev"
    options:
      persistent: true
      runInCI: false
