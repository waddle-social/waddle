apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ include "waddle-server.configMapName" . }}
  labels:
    {{- include "waddle-server.labels" . | nindent 4 }}
data:
  WADDLE_MODE: {{ .Values.config.mode | quote }}
  WADDLE_BASE_URL: {{ .Values.config.baseUrl | quote }}
  WADDLE_XMPP_ENABLED: {{ .Values.xmpp.enabled | toString | quote }}
  WADDLE_XMPP_DOMAIN: {{ .Values.xmpp.domain | quote }}
  WADDLE_XMPP_PORT: {{ .Values.xmpp.port | toString | quote }}
  WADDLE_XMPP_C2S_ADDR: {{ .Values.xmpp.c2sAddr | quote }}
  WADDLE_XMPP_S2S_ENABLED: {{ .Values.xmpp.s2sEnabled | toString | quote }}
  WADDLE_XMPP_S2S_ADDR: {{ .Values.xmpp.s2sAddr | quote }}
  WADDLE_NATIVE_AUTH_ENABLED: {{ .Values.xmpp.nativeAuthEnabled | toString | quote }}
  WADDLE_REGISTRATION_ENABLED: {{ .Values.xmpp.registrationEnabled | toString | quote }}
  WADDLE_DRAIN_TIMEOUT_SECS: {{ .Values.config.drainTimeoutSeconds | toString | quote }}
  RUST_LOG: {{ .Values.config.rustLog | quote }}
  {{- if .Values.config.corsOrigins }}
  WADDLE_CORS_ORIGINS: {{ .Values.config.corsOrigins | quote }}
  {{- end }}
  {{- if .Values.config.authProvidersJson }}
  WADDLE_AUTH_PROVIDERS_JSON: {{ .Values.config.authProvidersJson | quote }}
  {{- end }}
  {{- if .Values.telemetry.otlpEndpoint }}
  OTEL_EXPORTER_OTLP_ENDPOINT: {{ .Values.telemetry.otlpEndpoint | quote }}
  {{- end }}
  {{- if .Values.telemetry.serviceName }}
  OTEL_SERVICE_NAME: {{ .Values.telemetry.serviceName | quote }}
  {{- end }}
  {{- if .Values.telemetry.serviceVersion }}
  OTEL_SERVICE_VERSION: {{ .Values.telemetry.serviceVersion | quote }}
  {{- end }}
  {{- range $key, $value := .Values.config.extraEnv }}
  {{ $key }}: {{ $value | quote }}
  {{- end }}
