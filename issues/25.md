# Issue #25: Android Project Setup

## User Story
As a **developer**, I want to **set up a native Android application project** so that **we can build a high-performance mobile experience for Android users**.

## Description
Initialize a native Android project using Kotlin, set up the development environment, configure build tools, and establish the foundation for a modern Android application with proper architecture, dependency injection, and testing infrastructure.

## Acceptance Criteria
- [ ] Android Studio project initialized
- [ ] Kotlin configured with latest stable version
- [ ] Gradle build system optimized
- [ ] App architecture established (MVVM)
- [ ] Dependency injection with Hilt
- [ ] Navigation component setup
- [ ] Material Design 3 theme
- [ ] CI/CD pipeline configured

## Technical Implementation

### 1. Project Structure
```kotlin
// app/build.gradle.kts
plugins {
    id("com.android.application")
    id("org.jetbrains.kotlin.android")
    id("kotlin-kapt")
    id("dagger.hilt.android.plugin")
    id("androidx.navigation.safeargs.kotlin")
    id("kotlin-parcelize")
}

android {
    namespace = "com.waddle.android"
    compileSdk = 34

    defaultConfig {
        applicationId = "com.waddle.android"
        minSdk = 24 // Android 7.0
        targetSdk = 34
        versionCode = 1
        versionName = "1.0.0"

        testInstrumentationRunner = "androidx.test.runner.AndroidJUnitRunner"
        
        vectorDrawables {
            useSupportLibrary = true
        }
        
        // BuildConfig fields
        buildConfigField("String", "API_BASE_URL", "\"https://api.waddle.chat\"")
        buildConfigField("String", "WEBSOCKET_URL", "\"wss://ws.waddle.chat\"")
        buildConfigField("String", "CDN_URL", "\"https://cdn.waddle.chat\"")
    }

    buildTypes {
        debug {
            isMinifyEnabled = false
            isDebuggable = true
            applicationIdSuffix = ".debug"
            versionNameSuffix = "-DEBUG"
            
            buildConfigField("String", "API_BASE_URL", "\"https://api-dev.waddle.chat\"")
        }
        
        release {
            isMinifyEnabled = true
            isShrinkResources = true
            proguardFiles(
                getDefaultProguardFile("proguard-android-optimize.txt"),
                "proguard-rules.pro"
            )
            
            signingConfig = signingConfigs.getByName("release")
        }
        
        create("staging") {
            initWith(getByName("release"))
            applicationIdSuffix = ".staging"
            versionNameSuffix = "-STAGING"
            
            buildConfigField("String", "API_BASE_URL", "\"https://api-staging.waddle.chat\"")
        }
    }

    buildFeatures {
        compose = true
        buildConfig = true
        viewBinding = true
    }

    composeOptions {
        kotlinCompilerExtensionVersion = "1.5.8"
    }

    compileOptions {
        sourceCompatibility = JavaVersion.VERSION_17
        targetCompatibility = JavaVersion.VERSION_17
    }

    kotlinOptions {
        jvmTarget = "17"
        freeCompilerArgs += listOf(
            "-opt-in=kotlin.RequiresOptIn",
            "-opt-in=kotlinx.coroutines.ExperimentalCoroutinesApi",
            "-opt-in=kotlinx.coroutines.FlowPreview"
        )
    }
}

dependencies {
    // Core Android
    implementation("androidx.core:core-ktx:1.12.0")
    implementation("androidx.lifecycle:lifecycle-runtime-ktx:2.7.0")
    implementation("androidx.activity:activity-compose:1.8.2")
    
    // Compose
    implementation(platform("androidx.compose:compose-bom:2024.02.00"))
    implementation("androidx.compose.ui:ui")
    implementation("androidx.compose.ui:ui-graphics")
    implementation("androidx.compose.ui:ui-tooling-preview")
    implementation("androidx.compose.material3:material3")
    implementation("androidx.compose.material:material-icons-extended")
    
    // Navigation
    implementation("androidx.navigation:navigation-compose:2.7.7")
    implementation("androidx.hilt:hilt-navigation-compose:1.1.0")
    
    // Dependency Injection
    implementation("com.google.dagger:hilt-android:2.50")
    kapt("com.google.dagger:hilt-compiler:2.50")
    
    // Networking
    implementation("com.squareup.retrofit2:retrofit:2.9.0")
    implementation("com.squareup.retrofit2:converter-gson:2.9.0")
    implementation("com.squareup.okhttp3:okhttp:4.12.0")
    implementation("com.squareup.okhttp3:logging-interceptor:4.12.0")
    
    // WebSocket
    implementation("org.java-websocket:Java-WebSocket:1.5.4")
    
    // Image Loading
    implementation("io.coil-kt:coil-compose:2.5.0")
    
    // Database
    implementation("androidx.room:room-runtime:2.6.1")
    implementation("androidx.room:room-ktx:2.6.1")
    kapt("androidx.room:room-compiler:2.6.1")
    
    // DataStore
    implementation("androidx.datastore:datastore-preferences:1.0.0")
    
    // WorkManager
    implementation("androidx.work:work-runtime-ktx:2.9.0")
    
    // Testing
    testImplementation("junit:junit:4.13.2")
    testImplementation("org.mockito.kotlin:mockito-kotlin:5.2.1")
    testImplementation("org.jetbrains.kotlinx:kotlinx-coroutines-test:1.7.3")
    
    androidTestImplementation("androidx.test.ext:junit:1.1.5")
    androidTestImplementation("androidx.test.espresso:espresso-core:3.5.1")
    androidTestImplementation(platform("androidx.compose:compose-bom:2024.02.00"))
    androidTestImplementation("androidx.compose.ui:ui-test-junit4")
    
    debugImplementation("androidx.compose.ui:ui-tooling")
    debugImplementation("androidx.compose.ui:ui-test-manifest")
}
```

### 2. Application Architecture
```kotlin
// Application class
@HiltAndroidApp
class WaddleApplication : Application() {
    override fun onCreate() {
        super.onCreate()
        
        // Initialize crash reporting
        if (!BuildConfig.DEBUG) {
            CrashReporting.init(this)
        }
        
        // Initialize app-wide configuration
        initializeApp()
    }
    
    private fun initializeApp() {
        // Configure WorkManager
        val config = Configuration.Builder()
            .setMinimumLoggingLevel(if (BuildConfig.DEBUG) Log.DEBUG else Log.ERROR)
            .build()
        WorkManager.initialize(this, config)
        
        // Initialize notification channels
        NotificationChannelManager.createChannels(this)
        
        // Configure Coil image loader
        ImageLoader.Builder(this)
            .crossfade(true)
            .respectCacheHeaders(false)
            .diskCachePolicy(CachePolicy.ENABLED)
            .memoryCachePolicy(CachePolicy.ENABLED)
            .build()
            .let { Coil.setImageLoader(it) }
    }
}

// Base architecture components
abstract class BaseViewModel<State, Event, Effect> : ViewModel() {
    private val initialState: State by lazy { createInitialState() }
    
    private val _uiState = MutableStateFlow(initialState)
    val uiState: StateFlow<State> = _uiState.asStateFlow()
    
    private val _effect = MutableSharedFlow<Effect>()
    val effect: SharedFlow<Effect> = _effect.asSharedFlow()
    
    abstract fun createInitialState(): State
    abstract fun handleEvent(event: Event)
    
    protected fun setState(reduce: State.() -> State) {
        _uiState.update { it.reduce() }
    }
    
    protected fun setEffect(effect: Effect) {
        viewModelScope.launch {
            _effect.emit(effect)
        }
    }
}

// Repository pattern
interface WaddleRepository {
    suspend fun getWaddles(): Flow<List<Waddle>>
    suspend fun getWaddle(id: String): Waddle
    suspend fun createWaddle(request: CreateWaddleRequest): Waddle
    suspend fun updateWaddle(id: String, updates: WaddleUpdates): Waddle
    suspend fun deleteWaddle(id: String)
}

@Singleton
class WaddleRepositoryImpl @Inject constructor(
    private val api: WaddleApi,
    private val dao: WaddleDao,
    private val dispatcher: CoroutineDispatcher = Dispatchers.IO
) : WaddleRepository {
    
    override suspend fun getWaddles(): Flow<List<Waddle>> = flow {
        // Emit cached data first
        dao.getAllWaddles().firstOrNull()?.let { emit(it) }
        
        // Fetch from network
        try {
            val waddles = api.getWaddles()
            dao.insertWaddles(waddles)
            emit(waddles)
        } catch (e: Exception) {
            // Emit cached data on error
            dao.getAllWaddles().collect { emit(it) }
        }
    }.flowOn(dispatcher)
}
```

### 3. Dependency Injection Setup
```kotlin
// DI Modules
@Module
@InstallIn(SingletonComponent::class)
object NetworkModule {
    
    @Provides
    @Singleton
    fun provideOkHttpClient(
        authInterceptor: AuthInterceptor,
        loggingInterceptor: HttpLoggingInterceptor
    ): OkHttpClient {
        return OkHttpClient.Builder()
            .addInterceptor(authInterceptor)
            .addInterceptor(loggingInterceptor)
            .connectTimeout(30, TimeUnit.SECONDS)
            .readTimeout(30, TimeUnit.SECONDS)
            .writeTimeout(30, TimeUnit.SECONDS)
            .build()
    }
    
    @Provides
    @Singleton
    fun provideRetrofit(okHttpClient: OkHttpClient): Retrofit {
        return Retrofit.Builder()
            .baseUrl(BuildConfig.API_BASE_URL)
            .client(okHttpClient)
            .addConverterFactory(GsonConverterFactory.create())
            .build()
    }
    
    @Provides
    @Singleton
    fun provideWaddleApi(retrofit: Retrofit): WaddleApi {
        return retrofit.create(WaddleApi::class.java)
    }
    
    @Provides
    @Singleton
    fun provideLoggingInterceptor(): HttpLoggingInterceptor {
        return HttpLoggingInterceptor().apply {
            level = if (BuildConfig.DEBUG) {
                HttpLoggingInterceptor.Level.BODY
            } else {
                HttpLoggingInterceptor.Level.NONE
            }
        }
    }
}

@Module
@InstallIn(SingletonComponent::class)
object DatabaseModule {
    
    @Provides
    @Singleton
    fun provideDatabase(@ApplicationContext context: Context): WaddleDatabase {
        return Room.databaseBuilder(
            context,
            WaddleDatabase::class.java,
            "waddle_database"
        )
            .fallbackToDestructiveMigration()
            .build()
    }
    
    @Provides
    fun provideWaddleDao(database: WaddleDatabase): WaddleDao {
        return database.waddleDao()
    }
    
    @Provides
    fun provideMessageDao(database: WaddleDatabase): MessageDao {
        return database.messageDao()
    }
}

@Module
@InstallIn(SingletonComponent::class)
abstract class RepositoryModule {
    
    @Binds
    abstract fun bindWaddleRepository(
        impl: WaddleRepositoryImpl
    ): WaddleRepository
    
    @Binds
    abstract fun bindAuthRepository(
        impl: AuthRepositoryImpl
    ): AuthRepository
    
    @Binds
    abstract fun bindMessageRepository(
        impl: MessageRepositoryImpl
    ): MessageRepository
}
```

### 4. Navigation Setup
```kotlin
// Navigation graph
@Composable
fun WaddleNavigation(
    navController: NavHostController = rememberNavController()
) {
    NavHost(
        navController = navController,
        startDestination = if (isLoggedIn()) Screen.Home.route else Screen.Login.route
    ) {
        // Auth flow
        composable(Screen.Login.route) {
            LoginScreen(
                onLoginSuccess = {
                    navController.navigate(Screen.Home.route) {
                        popUpTo(Screen.Login.route) { inclusive = true }
                    }
                },
                onNavigateToRegister = {
                    navController.navigate(Screen.Register.route)
                }
            )
        }
        
        composable(Screen.Register.route) {
            RegisterScreen(
                onRegisterSuccess = {
                    navController.navigate(Screen.Home.route) {
                        popUpTo(Screen.Login.route) { inclusive = true }
                    }
                }
            )
        }
        
        // Main app flow
        composable(Screen.Home.route) {
            HomeScreen(
                onNavigateToWaddle = { waddleId ->
                    navController.navigate(Screen.Waddle.createRoute(waddleId))
                }
            )
        }
        
        composable(
            route = Screen.Waddle.route,
            arguments = listOf(navArgument("waddleId") { type = NavType.StringType })
        ) { backStackEntry ->
            val waddleId = backStackEntry.arguments?.getString("waddleId")!!
            WaddleScreen(
                waddleId = waddleId,
                onNavigateToChannel = { channelId ->
                    navController.navigate(Screen.Channel.createRoute(waddleId, channelId))
                },
                onNavigateBack = {
                    navController.popBackStack()
                }
            )
        }
        
        composable(
            route = Screen.Channel.route,
            arguments = listOf(
                navArgument("waddleId") { type = NavType.StringType },
                navArgument("channelId") { type = NavType.StringType }
            )
        ) { backStackEntry ->
            val waddleId = backStackEntry.arguments?.getString("waddleId")!!
            val channelId = backStackEntry.arguments?.getString("channelId")!!
            ChannelScreen(
                waddleId = waddleId,
                channelId = channelId,
                onNavigateToVoice = {
                    navController.navigate(Screen.VoiceChannel.createRoute(waddleId, channelId))
                }
            )
        }
        
        // Voice channel
        composable(
            route = Screen.VoiceChannel.route,
            arguments = listOf(
                navArgument("waddleId") { type = NavType.StringType },
                navArgument("channelId") { type = NavType.StringType }
            )
        ) { backStackEntry ->
            val waddleId = backStackEntry.arguments?.getString("waddleId")!!
            val channelId = backStackEntry.arguments?.getString("channelId")!!
            VoiceChannelScreen(
                waddleId = waddleId,
                channelId = channelId
            )
        }
        
        // Settings
        composable(Screen.Settings.route) {
            SettingsScreen()
        }
    }
}

sealed class Screen(val route: String) {
    object Login : Screen("login")
    object Register : Screen("register")
    object Home : Screen("home")
    object Waddle : Screen("waddle/{waddleId}") {
        fun createRoute(waddleId: String) = "waddle/$waddleId"
    }
    object Channel : Screen("waddle/{waddleId}/channel/{channelId}") {
        fun createRoute(waddleId: String, channelId: String) = 
            "waddle/$waddleId/channel/$channelId"
    }
    object VoiceChannel : Screen("waddle/{waddleId}/voice/{channelId}") {
        fun createRoute(waddleId: String, channelId: String) = 
            "waddle/$waddleId/voice/$channelId"
    }
    object Settings : Screen("settings")
}
```

### 5. Material Design 3 Theme
```kotlin
// Theme configuration
@Composable
fun WaddleTheme(
    darkTheme: Boolean = isSystemInDarkTheme(),
    dynamicColor: Boolean = true,
    content: @Composable () -> Unit
) {
    val colorScheme = when {
        dynamicColor && Build.VERSION.SDK_INT >= Build.VERSION_CODES.S -> {
            val context = LocalContext.current
            if (darkTheme) dynamicDarkColorScheme(context) else dynamicLightColorScheme(context)
        }
        darkTheme -> DarkColorScheme
        else -> LightColorScheme
    }
    
    val view = LocalView.current
    if (!view.isInEditMode) {
        SideEffect {
            val window = (view.context as Activity).window
            window.statusBarColor = colorScheme.primary.toArgb()
            WindowCompat.getInsetsController(window, view).isAppearanceLightStatusBars = !darkTheme
        }
    }
    
    MaterialTheme(
        colorScheme = colorScheme,
        typography = Typography,
        content = content
    )
}

private val LightColorScheme = lightColorScheme(
    primary = WaddlePrimary,
    onPrimary = Color.White,
    primaryContainer = WaddlePrimaryContainer,
    onPrimaryContainer = WaddleOnPrimaryContainer,
    secondary = WaddleSecondary,
    onSecondary = Color.White,
    secondaryContainer = WaddleSecondaryContainer,
    onSecondaryContainer = WaddleOnSecondaryContainer,
    tertiary = WaddleTertiary,
    onTertiary = Color.White,
    tertiaryContainer = WaddleTertiaryContainer,
    onTertiaryContainer = WaddleOnTertiaryContainer,
    error = WaddleError,
    onError = Color.White,
    errorContainer = WaddleErrorContainer,
    onErrorContainer = WaddleOnErrorContainer,
    surface = WaddleSurface,
    onSurface = WaddleOnSurface,
    background = WaddleBackground,
    onBackground = WaddleOnBackground
)

private val DarkColorScheme = darkColorScheme(
    primary = WaddlePrimaryDark,
    onPrimary = WaddleOnPrimaryDark,
    primaryContainer = WaddlePrimaryContainerDark,
    onPrimaryContainer = WaddleOnPrimaryContainerDark,
    // ... other dark colors
)

val Typography = Typography(
    displayLarge = TextStyle(
        fontFamily = FontFamily.Default,
        fontWeight = FontWeight.Normal,
        fontSize = 57.sp,
        lineHeight = 64.sp,
        letterSpacing = (-0.25).sp
    ),
    displayMedium = TextStyle(
        fontFamily = FontFamily.Default,
        fontWeight = FontWeight.Normal,
        fontSize = 45.sp,
        lineHeight = 52.sp,
        letterSpacing = 0.sp
    ),
    // ... other text styles
)
```

### 6. CI/CD Configuration
```yaml
# .github/workflows/android.yml
name: Android CI

on:
  push:
    branches: [ main, develop ]
    paths:
      - 'android/**'
  pull_request:
    branches: [ main, develop ]
    paths:
      - 'android/**'

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v4
    
    - name: Set up JDK 17
      uses: actions/setup-java@v4
      with:
        java-version: '17'
        distribution: 'temurin'
        cache: gradle
    
    - name: Grant execute permission for gradlew
      run: chmod +x ./android/gradlew
      
    - name: Run unit tests
      run: ./gradlew test
      working-directory: ./android
      
    - name: Upload test results
      uses: actions/upload-artifact@v4
      if: always()
      with:
        name: test-results
        path: android/app/build/test-results
        
  build:
    runs-on: ubuntu-latest
    needs: test
    steps:
    - uses: actions/checkout@v4
    
    - name: Set up JDK 17
      uses: actions/setup-java@v4
      with:
        java-version: '17'
        distribution: 'temurin'
        cache: gradle
        
    - name: Build debug APK
      run: ./gradlew assembleDebug
      working-directory: ./android
      
    - name: Upload APK
      uses: actions/upload-artifact@v4
      with:
        name: debug-apk
        path: android/app/build/outputs/apk/debug/app-debug.apk
        
  lint:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v4
    
    - name: Set up JDK 17
      uses: actions/setup-java@v4
      with:
        java-version: '17'
        distribution: 'temurin'
        cache: gradle
        
    - name: Run lint
      run: ./gradlew lint
      working-directory: ./android
      
    - name: Upload lint results
      uses: actions/upload-artifact@v4
      if: always()
      with:
        name: lint-results
        path: android/app/build/reports/lint-results-debug.html
```

### 7. Development Tools Setup
```kotlin
// Debug tools
@Module
@InstallIn(SingletonComponent::class)
object DebugModule {
    
    @Provides
    @Singleton
    fun provideChuckerInterceptor(@ApplicationContext context: Context): ChuckerInterceptor {
        return ChuckerInterceptor.Builder(context)
            .collector(ChuckerCollector(context))
            .maxContentLength(250000L)
            .redactHeaders(emptySet())
            .alwaysReadResponseBody(false)
            .build()
    }
    
    @Provides
    @Singleton
    fun provideFlipperClient(@ApplicationContext context: Context): FlipperClient {
        return AndroidFlipperClient.getInstance(context).apply {
            addPlugin(InspectorFlipperPlugin(context, DescriptorMapping.withDefaults()))
            addPlugin(NetworkFlipperPlugin())
            addPlugin(DatabasesFlipperPlugin(context))
            addPlugin(SharedPreferencesFlipperPlugin(context))
        }
    }
}

// Compose Preview
@Preview(name = "Light Mode")
@Preview(
    name = "Dark Mode",
    uiMode = Configuration.UI_MODE_NIGHT_YES
)
@Composable
fun PreviewHomeScreen() {
    WaddleTheme {
        HomeScreen(
            onNavigateToWaddle = {}
        )
    }
}
```

## Dependencies
- Android Studio Hedgehog or later
- Kotlin 1.9+
- Android Gradle Plugin 8.2+
- JDK 17
- Android SDK 34

## Estimated Effort
**3 days**
- 1 day: Project setup and configuration
- 1 day: Architecture and DI setup
- 1 day: CI/CD and tooling configuration

## Notes
- Use Compose for all new UI
- Follow Material Design 3 guidelines
- Implement proper error handling
- Add crash reporting (Firebase Crashlytics)
- Configure ProGuard rules for release builds