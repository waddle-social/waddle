# Flux Notifications Configuration
# =================================
#
# Provides Slack notifications for Flux reconciliation events.
# Alerts on errors for all Kustomizations and HelmReleases.
#
# Prerequisites:
#   - Create the slack-webhook-url Secret out-of-band:
#     kubectl create secret generic slack-webhook-url \
#       --from-literal=address=https://hooks.slack.com/services/... \
#       -n flux-system
#
---
apiVersion: notification.toolkit.fluxcd.io/v1beta3
kind: Provider
metadata:
  name: slack
  namespace: flux-system
spec:
  type: slack
  channel: "#flux-alerts"
  secretRef:
    name: slack-webhook-url
---
apiVersion: notification.toolkit.fluxcd.io/v1beta3
kind: Alert
metadata:
  name: on-call
  namespace: flux-system
spec:
  providerRef:
    name: slack
  eventSeverity: error
  eventSources:
    - kind: Kustomization
      name: "*"
    - kind: HelmRelease
      name: "*"
